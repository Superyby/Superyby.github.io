<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Our Love Space | æˆ‘ä»¬çš„ä¸“å±ç§˜å¯†åŸºåœ°</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Noto+Serif+SC:wght@400;600;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== å…¨å±€å˜é‡ä¸æ ¸å¿ƒæ ·å¼ ==================== */
        :root {
            --primary: #ff758c;
            --primary-light: #ff9a9e;
            --secondary: #a18cd1;
            --accent: #fbc2eb;
            --deep: #2d3436;
            --text-main: #4a4a4a;
            --glass: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow: 0 15px 35px rgba(255, 117, 140, 0.2);
            --radius: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Quicksand', 'Noto Serif SC', sans-serif;
            background: linear-gradient(135deg, #fff5f7 0%, #f6e6ff 100%);
            color: var(--text-main);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ç»ç’ƒæ‹Ÿæ€é€šç”¨å¡ç‰‡ */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        /* ==================== å¯¼èˆªæ  ==================== */
        nav {
            position: fixed; top: 0; width: 100%; z-index: 1000;
            padding: 20px; transition: 0.4s;
        }
        nav.scrolled { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); padding: 10px 20px; }
        .nav-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Dancing Script', cursive; font-size: 28px; color: var(--primary); font-weight: bold; }
        
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { text-decoration: none; color: var(--text-main); font-weight: 600; font-size: 14px; }

        /* ==================== Hero è®¡æ—¶å™¨ & é‡Œç¨‹ç¢‘ ==================== */
        .hero { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 100px 20px; text-align: center; }
        .timer-container { margin-bottom: 40px; }
        .timer-display { display: flex; gap: 15px; justify-content: center; margin-top: 20px; }
        .timer-item { position: relative; width: 80px; }
        .timer-num { font-size: 2.5rem; font-weight: 800; color: var(--primary); display: block; }
        .timer-label { font-size: 12px; color: var(--text-light); text-transform: uppercase; }

        .milestone-tag {
            display: inline-block; padding: 8px 20px; background: white; border-radius: 50px;
            font-size: 14px; color: var(--secondary); margin-top: 20px; border: 1px dashed var(--secondary);
            animation: float 3s ease-in-out infinite;
        }

        /* ==================== åˆ›æ„åŠŸèƒ½ï¼šè®°å¿†ç¿»ç‰Œ ==================== */
        .roulette-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white; border: none; padding: 12px 30px; border-radius: 50px;
            font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 30px;
            box-shadow: 0 10px 20px rgba(255, 117, 140, 0.4);
        }
        .roulette-btn:hover { transform: scale(1.05); box-shadow: 0 15px 25px rgba(255, 117, 140, 0.5); }

        /* ==================== æ‹çˆ±æ¸…å• ==================== */
        .section { max-width: 1200px; margin: 80px auto; padding: 0 20px; }
        .section-title { text-align: center; font-size: 2.2rem; margin-bottom: 50px; font-family: 'Noto Serif SC'; }
        
        .bucket-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .bucket-item { padding: 25px; display: flex; align-items: center; gap: 15px; transition: 0.3s; }
        .bucket-item.completed { opacity: 0.7; background: rgba(255,255,255,0.4); }
        .bucket-item.completed .check-box { background: var(--primary); color: white; }
        .check-box { width: 30px; height: 30px; border: 2px solid var(--primary); border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* ==================== æ—¶å…‰èƒ¶å›Š ==================== */
        .capsule-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .capsule-card { padding: 30px; text-align: center; position: relative; overflow: hidden; }
        .capsule-lock { font-size: 40px; margin-bottom: 15px; display: block; }
        .capsule-date { font-size: 13px; color: var(--text-light); }
        .capsule-blur { filter: blur(8px); pointer-events: none; user-select: none; margin-top: 15px; }
        .capsule-unlocked .capsule-blur { filter: none; pointer-events: auto; }

        /* ==================== æ—¶é—´è½´ & ç›¸å†Œ (å¤ç”¨åŸæœ‰é£æ ¼ä½†ä¼˜åŒ–) ==================== */
        .timeline { position: relative; max-width: 800px; margin: 0 auto; }
        .timeline::before { content: ''; position: absolute; left: 50%; width: 2px; height: 100%; background: var(--accent); transform: translateX(-50%); }
        .timeline-item { width: 50%; padding: 20px; position: relative; clear: both; }
        .timeline-item:nth-child(even) { float: right; text-align: left; padding-left: 40px; }
        .timeline-item:nth-child(odd) { float: left; text-align: right; padding-right: 40px; }
        .timeline-dot { position: absolute; width: 16px; height: 16px; background: var(--primary); border-radius: 50%; top: 30px; }
        .timeline-item:nth-child(even) .timeline-dot { left: -8px; }
        .timeline-item:nth-child(odd) .timeline-dot { right: -8px; }

        /* ==================== å¼¹çª—è®¾è®¡ (ç”¨äºç®¡ç†å’ŒæŠ½å¥–) ==================== */
        .modal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px;
        }
        .modal-content { width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; padding: 40px; position: relative; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; }

        input, textarea, select {
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #eee; outline: none;
        }

        /* åŠ¨ç”» */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            .timeline::before { left: 20px; }
            .timeline-item { width: 100%; float: none !important; text-align: left !important; padding-left: 45px !important; }
            .timeline-dot { left: 12px !important; }
            .timer-num { font-size: 1.8rem; }
            .timer-item { width: 60px; }
        }
    </style>
</head>
<body>

    <canvas id="canvas" style="position: fixed; top:0; left:0; z-index:-1;"></canvas>

    <nav id="navbar">
        <div class="nav-content">
            <div class="logo">Our Love Story</div>
            <div class="nav-links">
                <a href="#wishlist">æ„¿æœ›æ¸…å•</a>
                <a href="#capsule">æ—¶å…‰èƒ¶å›Š</a>
                <a href="#timeline">æ—¶å…‰è½´</a>
                <a href="javascript:void(0)" onclick="openAdmin()">ç®¡ç†</a>
            </div>
        </div>
    </nav>

    <header class="hero">
        <div class="timer-container">
            <h2 style="font-family: 'Noto Serif SC';">æˆ‘ä»¬å·²ç»ç›¸çˆ±äº†</h2>
            <div class="timer-display" id="main-timer">
                <div class="timer-item"><span class="timer-num" id="d">0</span><span class="timer-label">Days</span></div>
                <div class="timer-item"><span class="timer-num" id="h">0</span><span class="timer-label">Hrs</span></div>
                <div class="timer-item"><span class="timer-num" id="m">0</span><span class="timer-label">Min</span></div>
                <div class="timer-item"><span class="timer-num" id="s">0</span><span class="timer-label">Sec</span></div>
            </div>
            <div id="next-milestone" class="milestone-tag">åŠ è½½ä¸­...</div>
        </div>
        
        <button class="roulette-btn" onclick="triggerRoulette()">ğŸ² ç¿»å¼€ä¸€æ®µæ—§æ—¶å…‰</button>
    </header>

    <section class="section" id="wishlist">
        <h2 class="section-title">ğŸ’• æ‹çˆ±æ¸…å•</h2>
        <div class="bucket-grid" id="bucket-list-container">
            </div>
    </section>

    <section class="section" id="capsule">
        <h2 class="section-title">â³ æ—¶å…‰èƒ¶å›Š</h2>
        <div class="capsule-grid" id="capsule-container">
            </div>
    </section>

    <section class="section" id="timeline">
        <h2 class="section-title">ğŸ“… æ—¶å…‰è½¨è¿¹</h2>
        <div class="timeline" id="timeline-container">
            </div>
    </section>

    <div id="adminModal" class="modal">
        <div class="modal-content glass-card">
            <span class="close-btn" onclick="closeAdmin()">&times;</span>
            <h3 style="margin-bottom:20px;">ç§˜å¯†åŸºåœ°ç®¡ç†</h3>
            
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button onclick="switchAdminTab('event')" class="roulette-btn" style="padding:8px 15px;">è®°äº‹/å›¾ç‰‡</button>
                <button onclick="switchAdminTab('wish')" class="roulette-btn" style="padding:8px 15px;">æ„¿æœ›</button>
                <button onclick="switchAdminTab('capsule')" class="roulette-btn" style="padding:8px 15px;">èƒ¶å›Š</button>
            </div>

            <div id="admin-form-area">
                </div>

            <hr style="margin:20px 0; opacity:0.2;">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button onclick="exportData()" style="background:#f0f0f0; border:none; padding:10px; border-radius:10px; cursor:pointer;">ğŸ’¾ å¯¼å‡ºå¤‡ä»½</button>
                <button onclick="importData()" style="background:#f0f0f0; border:none; padding:10px; border-radius:10px; cursor:pointer;">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
            </div>
        </div>
    </div>

    <div id="rouletteModal" class="modal">
        <div class="modal-content glass-card" style="text-align:center;">
            <span class="close-btn" onclick="document.getElementById('rouletteModal').style.display='none'">&times;</span>
            <div id="roulette-result"></div>
        </div>
    </div>

    <script>
        // ==================== é…ç½®ä¸æ•°æ® ====================
        const CONFIG = {
            startDate: '2024-05-20T00:00:00', // æ‹çˆ±å¼€å§‹æ—¶é—´
            password: '1314', // ç®¡ç†å¯†ç 
            music: 'https://api.uomg.com/api/rand.music?sort=çƒ­æ­Œæ¦œ' // ç¤ºä¾‹éŸ³ä¹
        };

        // æ•°æ®å­˜å‚¨ç»“æ„
        let storage = {
            events: JSON.parse(localStorage.getItem('love_events')) || [],
            wishes: JSON.parse(localStorage.getItem('love_wishes')) || [],
            capsules: JSON.parse(localStorage.getItem('love_capsules')) || []
        };

        // ==================== æ ¸å¿ƒï¼šè®¡æ—¶å™¨ä¸é‡Œç¨‹ç¢‘ ====================
        function initTimer() {
            const update = () => {
                const start = new Date(CONFIG.startDate).getTime();
                const now = new Date().getTime();
                const diff = now - start;

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                document.getElementById('d').innerText = days;
                document.getElementById('h').innerText = hours;
                document.getElementById('m').innerText = minutes;
                document.getElementById('s').innerText = seconds;

                // è®¡ç®—é‡Œç¨‹ç¢‘
                let next;
                const milestones = [100, 200, 300, 365, 520, 800, 1000, 1314, 2000];
                for (let m of milestones) {
                    if (m > days) { next = m; break; }
                }
                document.getElementById('next-milestone').innerText = `âœ¨ è·ç¦»æˆ‘ä»¬çš„ ${next} å¤©çºªå¿µæ—¥è¿˜å‰© ${next - days} å¤©`;
            };
            setInterval(update, 1000);
            update();
        }

        // ==================== åˆ›æ„åŠŸèƒ½ï¼šè®°å¿†æŠ½å¥– ====================
        function triggerRoulette() {
            const allMemories = [...storage.events, ...storage.wishes.filter(w => w.completed)];
            if (allMemories.length === 0) {
                alert("è®°å¿†åº“è¿˜æ˜¯ç©ºçš„å“¦ï¼Œå¿«å»æ·»åŠ ç‚¹ç‚¹æ»´æ»´å§ï¼");
                return;
            }

            const item = allMemories[Math.floor(Math.random() * allMemories.length)];
            const resultDiv = document.getElementById('roulette-result');
            
            resultDiv.innerHTML = `
                <h2 style="color:var(--primary); margin-bottom:15px;">è¿˜è®°å¾—è¿™å¤©å—ï¼Ÿ</h2>
                ${item.image ? `<img src="${item.image}" style="width:100%; border-radius:15px; margin-bottom:15px;">` : ''}
                <p style="font-size:18px; font-weight:600;">${item.title || item.text}</p>
                <p style="color:var(--text-light); font-size:14px; margin-top:10px;">${item.date || 'å¿ƒæ„¿è¾¾æˆæ—¥'}</p>
            `;
            
            document.getElementById('rouletteModal').style.display = 'flex';
        }

        // ==================== æ•°æ®æ¸²æŸ“é€»è¾‘ ====================
        function renderAll() {
            // æ¸²æŸ“æ„¿æœ›
            const wishContainer = document.getElementById('bucket-list-container');
            wishContainer.innerHTML = storage.wishes.map((w, i) => `
                <div class="bucket-item glass-card ${w.completed ? 'completed' : ''}" onclick="toggleWish(${i})">
                    <div class="check-box">${w.completed ? 'âœ“' : ''}</div>
                    <span>${w.text}</span>
                </div>
            `).join('');

            // æ¸²æŸ“æ—¶å…‰èƒ¶å›Š
            const capsuleContainer = document.getElementById('capsule-container');
            const now = new Date().getTime();
            capsuleContainer.innerHTML = storage.capsules.map(c => {
                const unlockTime = new Date(c.unlockDate).getTime();
                const isLocked = now < unlockTime;
                return `
                    <div class="capsule-card glass-card ${isLocked ? '' : 'capsule-unlocked'}">
                        <span class="capsule-lock">${isLocked ? 'ğŸ”’' : 'ğŸ'}</span>
                        <div class="capsule-date">è®¡åˆ’è§£é”ï¼š${c.unlockDate}</div>
                        <div class="${isLocked ? 'capsule-blur' : ''}">
                            <h4 style="margin:10px 0;">${isLocked ? 'è¿™æ˜¯ä¸€ä¸ªç§˜å¯†' : c.title}</h4>
                            <p>${isLocked ? 'ç­‰åˆ°é‚£å¤©å†æ¥æ­å¼€å§...' : c.content}</p>
                        </div>
                    </div>
                `;
            }).join('');

            // æ¸²æŸ“æ—¶é—´è½´
            const timelineContainer = document.getElementById('timeline-container');
            timelineContainer.innerHTML = storage.events.sort((a,b) => new Date(b.date) - new Date(a.date)).map(e => `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="glass-card" style="padding:20px;">
                        <span style="font-size:12px; color:var(--primary);">${e.date}</span>
                        <h4 style="margin:5px 0;">${e.title}</h4>
                        ${e.image ? `<img src="${e.image}" style="width:100%; border-radius:10px; margin:10px 0;">` : ''}
                        <p style="font-size:14px;">${e.text}</p>
                    </div>
                </div>
            `).join('');
        }

        // ==================== ç®¡ç†é€»è¾‘ ====================
        let currentTab = 'event';
        function switchAdminTab(tab) {
            currentTab = tab;
            const area = document.getElementById('admin-form-area');
            if(tab === 'event') {
                area.innerHTML = `
                    <input type="text" id="ev-title" placeholder="äº‹ä»¶æ ‡é¢˜">
                    <textarea id="ev-text" placeholder="æè¿°è¿™å¤©çš„æ•…äº‹..."></textarea>
                    <input type="date" id="ev-date">
                    <input type="file" id="ev-img" accept="image/*" onchange="handleImage(this)">
                    <button onclick="saveEvent()" class="roulette-btn" style="width:100%;">ä¿å­˜å›å¿†</button>
                `;
            } else if(tab === 'wish') {
                area.innerHTML = `
                    <input type="text" id="wi-text" placeholder="æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªæ„¿æœ›æ˜¯...">
                    <button onclick="saveWish()" class="roulette-btn" style="width:100%;">åŠ å…¥æ¸…å•</button>
                `;
            } else if(tab === 'capsule') {
                area.innerHTML = `
                    <input type="text" id="ca-title" placeholder="ç»™æœªæ¥çš„ä¿¡å°æ ‡é¢˜">
                    <textarea id="ca-content" placeholder="å†™ä¸‹ç°åœ¨çš„æ‚„æ‚„è¯..."></textarea>
                    <p style="font-size:12px; color:gray;">è§£é”æ—¥æœŸï¼š</p>
                    <input type="date" id="ca-date">
                    <button onclick="saveCapsule()" class="roulette-btn" style="width:100%;">å°å­˜èƒ¶å›Š</button>
                `;
            }
        }

        let tempImage = "";
        function handleImage(input) {
            const reader = new FileReader();
            reader.onload = e => tempImage = e.target.result;
            reader.readAsDataURL(input.files[0]);
        }

        function saveEvent() {
            const data = {
                title: document.getElementById('ev-title').value,
                text: document.getElementById('ev-text').value,
                date: document.getElementById('ev-date').value,
                image: tempImage
            };
            storage.events.push(data);
            syncAndRefresh();
        }

        function saveWish() {
            storage.wishes.push({ text: document.getElementById('wi-text').value, completed: false });
            syncAndRefresh();
        }

        function saveCapsule() {
            storage.capsules.push({
                title: document.getElementById('ca-title').value,
                content: document.getElementById('ca-content').value,
                unlockDate: document.getElementById('ca-date').value
            });
            syncAndRefresh();
        }

        function toggleWish(index) {
            storage.wishes[index].completed = !storage.wishes[index].completed;
            syncAndRefresh();
        }

        function syncAndRefresh() {
            localStorage.setItem('love_events', JSON.stringify(storage.events));
            localStorage.setItem('love_wishes', JSON.stringify(storage.wishes));
            localStorage.setItem('love_capsules', JSON.stringify(storage.capsules));
            renderAll();
            tempImage = "";
            alert("å·²åŒæ­¥åˆ°ä½ çš„ç©ºé—´ï¼");
        }

        // ==================== æ•°æ®å¤‡ä»½åŠŸèƒ½ ====================
        function exportData() {
            const dataStr = JSON.stringify(storage);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `love_backup_${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.onchange = e => {
                const reader = new FileReader();
                reader.onload = ev => {
                    const imported = JSON.parse(ev.target.result);
                    if(confirm("å¯¼å…¥å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ")) {
                        storage = imported;
                        syncAndRefresh();
                    }
                };
                reader.readAsText(e.target.files[0]);
            };
            input.click();
        }

        // ==================== ç•Œé¢æ§åˆ¶ ====================
        function openAdmin() {
            const pass = prompt("è¯·è¾“å…¥æš—å·ï¼š");
            if(pass === CONFIG.password) {
                document.getElementById('adminModal').style.display = 'flex';
                switchAdminTab('event');
            } else {
                alert("æš—å·ä¸å¯¹å“¦ï¼Œäº²çˆ±çš„~");
            }
        }

        function closeAdmin() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // ç®€æ˜“ç²’å­èƒŒæ™¯
        function initParticles() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            let w, h, particles = [];
            const resize = () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; };
            window.onresize = resize; resize();
            
            for(let i=0; i<50; i++) particles.push({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*2+1, v: Math.random()*0.5 });
            
            function animate() {
                ctx.clearRect(0,0,w,h);
                ctx.fillStyle = "rgba(255, 117, 140, 0.2)";
                particles.forEach(p => {
                    p.y -= p.v;
                    if(p.y < -10) p.y = h + 10;
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
                });
                requestAnimationFrame(animate);
            }
            animate();
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            initTimer();
            initParticles();
            renderAll();
            
            // å¯¼èˆªæ æ•ˆæœ
            window.addEventListener('scroll', () => {
                document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
            });
        };
    </script>
</body>
</html>