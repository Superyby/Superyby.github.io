<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory & Eternity | æˆ‘ä»¬çš„æ°¸æ’è¯—ç¯‡</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Noto+Serif+SC:wght@300;600&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --rose: #ffafbd;
            --deep-rose: #ff8e91;
            --glass: rgba(255, 255, 255, 0.85);
            --text: #4a4a4a;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #fffafa;
            color: var(--text);
            font-family: 'Noto Serif SC', serif;
            overflow-x: hidden;
        }

        /* ==================== 1. 3D ä¿¡å°å¼€å±åŠ¨ç”» ==================== */
        #envelope-wrapper {
            position: fixed; inset: 0; background: #f4f1ea; z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            transition: transform 1.2s cubic-bezier(0.7, 0, 0.3, 1), opacity 1s;
        }
        .envelope {
            position: relative; width: 300px; height: 200px; background: #e0d8c3;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); cursor: pointer;
        }
        .envelope::before { /* ä¿¡å°ç›– */
            content: ""; position: absolute; top: 0; z-index: 2;
            border-top: 110px solid #d1c7ae; border-left: 150px solid transparent; border-right: 150px solid transparent;
            transform-origin: top; transition: all 0.8s;
        }
        .envelope.open::before { transform: rotateX(180deg); z-index: 0; }
        .seal {
            position: absolute; top: 90px; left: 130px; width: 40px; height: 40px;
            background: #b22222; border-radius: 50%; z-index: 3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px; transition: 0.5s;
        }
        .envelope.open .seal { opacity: 0; transform: scale(2); }
        .letter-preview {
            position: absolute; top: 10px; left: 10px; width: 280px; height: 180px;
            background: white; z-index: 1; transition: 0.8s; padding: 20px;
            font-family: 'Ma Shan Zheng', cursive; text-align: center;
        }
        .envelope.open .letter-preview { transform: translateY(-120px); }

        /* ==================== 2. å…¨å±€å”¯ç¾æ ·å¼ ==================== */
        #main-site { display: none; opacity: 0; transition: 2s; }
        .bg-glow {
            position: fixed; width: 400px; height: 400px; background: radial-gradient(circle, rgba(255,175,189,0.3) 0%, transparent 70%);
            z-index: -1; pointer-events: none; filter: blur(50px);
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        nav {
            padding: 30px; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px);
        }
        .logo { font-family: 'Dancing Script', cursive; font-size: 30px; color: var(--deep-rose); }

        /* è®¡æ—¶å™¨æ¨¡å— */
        .hero { height: 80vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .timer-grid { display: flex; gap: 25px; margin-top: 30px; }
        .t-card { 
            background: var(--glass); padding: 25px; border-radius: 20px; box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.6);
        }
        .t-num { font-size: 3.5rem; color: var(--deep-rose); font-weight: 300; display: block; }
        .t-unit { font-size: 12px; letter-spacing: 3px; opacity: 0.5; }

        /* æ‹ç«‹å¾—ç…§ç‰‡å¢™ */
        .section-title { font-size: 2rem; text-align: center; margin: 80px 0 40px; font-family: 'Noto Serif SC'; letter-spacing: 5px; }
        .photo-wall { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 30px; padding: 0 5vw; 
        }
        .polaroid {
            background: white; padding: 15px 15px 40px; box-shadow: var(--shadow);
            transform: rotate(var(--r)); transition: 0.3s; cursor: zoom-in;
        }
        .polaroid:hover { transform: rotate(0deg) scale(1.05); z-index: 10; }
        .polaroid img { width: 100%; height: 200px; object-fit: cover; filter: sepia(0.2); }
        .polaroid p { margin-top: 15px; font-family: 'Ma Shan Zheng'; font-size: 18px; color: #666; text-align: center; }

        /* æ—¶é—´è½´ï¼šæ–‡è‰ºæ’ç‰ˆ */
        .timeline { max-width: 900px; margin: 0 auto; position: relative; }
        .timeline::before { content: ""; position: absolute; left: 50%; height: 100%; width: 1px; background: #eee; }
        .timeline-item { width: 100%; margin-bottom: 60px; display: flex; justify-content: space-between; align-items: center; }
        .timeline-content { width: 42%; background: var(--glass); padding: 30px; border-radius: 20px; box-shadow: var(--shadow); position: relative; }
        .timeline-item:nth-child(even) { flex-direction: row-reverse; }
        .timeline-date { color: var(--deep-rose); font-weight: bold; margin-bottom: 10px; display: block; }

        /* ==================== 3. ç”µå½±ç‰‡å°¾å¼è¯»ä¿¡ç‰¹æ•ˆ ==================== */
        #movie-reader {
            position: fixed; inset: 0; background: rgba(10,10,10,0.98); z-index: 20000;
            display: none; color: #ddd; flex-direction: column; align-items: center; overflow: hidden;
        }
        .credits-wrap {
            position: absolute; width: 80%; max-width: 600px; top: 100%;
            text-align: center; line-height: 2.5; font-size: 1.2rem;
            animation: scrollUp 20s linear forwards;
        }
        @keyframes scrollUp {
            from { top: 100%; }
            to { top: -150%; }
        }
        .reader-close { position: fixed; right: 40px; top: 40px; color: white; cursor: pointer; font-size: 30px; z-index: 20001; }

        /* ç®¡ç†å¼¹çª—ç¾åŒ– */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(255,175,189,0.1); backdrop-filter: blur(10px);
            display: none; justify-content: center; align-items: center; z-index: 5000;
        }
        .modal-box {
            background: white; padding: 50px; border-radius: 40px; width: 90%; max-width: 500px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 8px solid #fff;
        }
        input, textarea { width: 100%; padding: 15px; margin: 15px 0; border: 1px solid #eee; border-radius: 15px; background: #fdfdfd; outline: none; }
        .btn-submit { background: var(--deep-rose); color: white; border: none; padding: 15px 40px; border-radius: 50px; width: 100%; cursor: pointer; font-weight: bold; }

    </style>
</head>
<body>

    <div id="envelope-wrapper">
        <div class="envelope" id="main-envelope" onclick="openEnvelope()">
            <div class="seal">â™¥</div>
            <div class="letter-preview">
                <p style="margin-top:20px;">äº²çˆ±çš„ï¼š</p>
                <p style="margin-top:10px;">å±•ä¿¡ä½³ï¼Œè¿™æ˜¯å±äºæˆ‘ä»¬çš„æ—¶å…‰é›†...</p>
                <p style="margin-top:30px; font-size: 14px; opacity: 0.5;">ï¼ˆç‚¹å‡»å¼€å¯ï¼‰</p>
            </div>
        </div>
    </div>

    <div id="main-site">
        <div class="bg-glow" style="top: -100px; left: -100px;"></div>
        <div class="bg-glow" style="bottom: 0; right: 0; background: radial-gradient(circle, rgba(161,140,209,0.2) 0%, transparent 70%);"></div>

        <nav>
            <div class="logo">Our Eternal Memory</div>
            <button class="btn-submit" style="width:auto; padding: 10px 25px;" onclick="showAdmin()">ç®¡ç†ç©ºé—´</button>
        </nav>

        <header class="hero">
            <h2 style="letter-spacing: 10px; opacity: 0.4; font-weight: 300;">SINCE WE MET</h2>
            <div class="timer-grid" id="main-timer">
                <div class="t-card"><span class="t-num" id="d">000</span><span class="t-unit">DAYS</span></div>
                <div class="t-card"><span class="t-num" id="h">00</span><span class="t-unit">HOURS</span></div>
                <div class="t-card"><span class="t-num" id="m">00</span><span class="t-unit">MINS</span></div>
                <div class="t-card"><span class="t-num" id="s">00</span><span class="t-unit">SECS</span></div>
            </div>
            <p id="milestone-text" style="margin-top: 30px; color: var(--deep-rose); font-style: italic;"></p>
        </header>

        <section>
            <h2 class="section-title">æµ®å…‰æ å½± Â· Photo Wall</h2>
            <div class="photo-wall" id="photo-render"></div>
        </section>

        <section>
            <h2 class="section-title">æ—¶å…‰è½¨è¿¹ Â· Timeline</h2>
            <div class="timeline" id="timeline-render"></div>
        </section>

        <section style="display: flex; flex-wrap: wrap; gap: 50px; padding: 100px 5vw;">
            <div style="flex: 1; min-width: 300px;">
                <h2 class="section-title" style="text-align: left;">æ‹çˆ±æ¸…å• Â· Bucket List</h2>
                <div id="wish-render"></div>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <h2 class="section-title" style="text-align: left;">æ—¶å…‰èƒ¶å›Š Â· Time Capsule</h2>
                <div id="capsule-render"></div>
            </div>
        </section>
    </div>

    <div id="movie-reader">
        <span class="reader-close" onclick="closeReader()">&times;</span>
        <div class="credits-wrap" id="credits-content"></div>
    </div>

    <div class="modal-overlay" id="admin-modal">
        <div class="modal-box">
            <h3 style="text-align: center; margin-bottom: 20px;">è®°å½•æ–°æ—¶åˆ»</h3>
            <select id="data-type">
                <option value="photo">æ·»åŠ ç…§ç‰‡</option>
                <option value="moment">æ·»åŠ é‡Œç¨‹ç¢‘</option>
                <option value="capsule">å†™æ—¶å…‰èƒ¶å›Š</option>
            </select>
            <input type="text" id="ipt-title" placeholder="æ ‡é¢˜/æè¿°">
            <input type="date" id="ipt-date">
            <textarea id="ipt-content" rows="4" placeholder="å…·ä½“å†…å®¹/ç…§ç‰‡åœ°å€"></textarea>
            <button class="btn-submit" onclick="saveData()">å­˜å…¥è®°å¿†åº“</button>
            <button onclick="hideAdmin()" style="background:none; border:none; width:100%; margin-top:15px; color:#aaa;">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        // ==================== 1. é…ç½®ä¸æµ‹è¯•æ•°æ® ====================
        const CONFIG = {
            startDate: '2024-05-20T13:14:00',
            pwd: '1314'
        };

        const MOCK_DATA = {
            photos: [
                { url: "https://picsum.photos/500/600?r=1", note: "ç¬¬ä¸€æ¬¡é‡é¤çš„åˆå" },
                { url: "https://picsum.photos/500/600?r=2", note: "å¤§é›¨é‡Œå¥”è·‘çš„æˆ‘ä»¬" },
                { url: "https://picsum.photos/500/600?r=3", note: "æµ·è¾¹çš„é‚£ä¸ªæ—¥è½" },
                { url: "https://picsum.photos/500/600?r=4", note: "å›¾ä¹¦é¦†å·æ‹çš„ä¾§é¢œ" }
            ],
            moments: [
                { date: "2024-05-20", title: "é‡è§ä½ ï¼Œä¸‡ç‰©å¯çˆ±", text: "é‚£æ˜¯æˆ‘ä»¬æ•…äº‹çš„å¼€å§‹ï¼Œå¤©ç©ºæ˜¯æ©˜å­å‘³çš„ã€‚" },
                { date: "2024-08-15", title: "ç¬¬ä¸€æŸç«ç‘°", text: "ä½ æ§ç€èŠ±å‡ºç°åœ¨æ ¡é—¨å£ï¼Œç¬‘å¾—æ¯”èŠ±è¿˜ç¿çƒ‚ã€‚" }
            ],
            capsules: [
                { unlock: "2025-05-20", title: "è‡´ä¸€å¹´åçš„æˆ‘ä»¬", content: "äº²çˆ±çš„ï¼Œå½“ä½ çœ‹åˆ°è¿™å°ä¿¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»å…±åŒèµ°è¿‡äº†ä¸€å¹´ã€‚\nè¿™ä¸€å¹´é‡Œï¼Œæˆ‘ä»¬æœ‰è¿‡äº‰åµï¼Œä½†æ›´å¤šçš„æ˜¯ç”œèœœã€‚\nè¿˜è®°å¾—é‚£ä¸ªå…³äºæœªæ¥çš„çº¦å®šå—ï¼Ÿ\næˆ‘æƒ³å’Œä½ å»åœ£æ‰˜é‡Œå°¼ï¼Œå»åŒ—æ¬§çœ‹æå…‰...\næ— è®ºæ—¶é—´æ€ä¹ˆæµé€ï¼Œæˆ‘çš„çˆ±å§‹ç»ˆå¦‚åˆã€‚\nâ€”â€” çˆ±ä½ çš„æˆ‘" },
                { unlock: "2026-02-14", title: "æƒ…äººèŠ‚çš„çº¦å®š", content: "è¿™æ˜¯ä¸€å°è¿˜åœ¨å°å°ä¸­çš„ä¿¡ä»¶..." }
            ],
            wishes: ["ä¸€èµ·çœ‹50æ¬¡æ—¥è½", "å…»ä¸€åªå«å¸ƒä¸çš„çŒ«", "å»ä¸€æ¬¡å†°å²›", "å­¦ä¼šä¸ºä½ åšä¸€é¡¿æ™šé¤"]
        };

        let db = JSON.parse(localStorage.getItem('love_eternity')) || MOCK_DATA;

        // ==================== 2. å¼€å±é€»è¾‘ ====================
        function openEnvelope() {
            const env = document.getElementById('main-envelope');
            env.classList.add('open');
            setTimeout(() => {
                document.getElementById('envelope-wrapper').style.transform = 'translateY(-100%)';
                document.getElementById('envelope-wrapper').style.opacity = '0';
                const main = document.getElementById('main-site');
                main.style.display = 'block';
                setTimeout(() => main.style.opacity = '1', 100);
                initAll();
            }, 1800);
        }

        // ==================== 3. æ ¸å¿ƒåŠŸèƒ½ ====================
        function initAll() {
            startTimer();
            renderPhotos();
            renderTimeline();
            renderWishes();
            renderCapsules();
        }

        function startTimer() {
            const update = () => {
                const diff = new Date() - new Date(CONFIG.startDate);
                const d = Math.floor(diff / 86400000);
                document.getElementById('d').innerText = d.toString().padStart(3, '0');
                document.getElementById('h').innerText = Math.floor((diff % 86400000) / 3600000).toString().padStart(2,'0');
                document.getElementById('m').innerText = Math.floor((diff % 3600000) / 60000).toString().padStart(2,'0');
                document.getElementById('s').innerText = Math.floor((diff % 60000) / 1000).toString().padStart(2,'0');
                
                const next = 520 - (d % 520);
                document.getElementById('milestone-text').innerText = `âœ¨ è·ç¦»ä¸‹ä¸€æ¬¡â€œ520å¤©â€ä»ªå¼æ„Ÿè¿˜å‰© ${next} å¤©`;
            }
            setInterval(update, 1000); update();
        }

        function renderPhotos() {
            document.getElementById('photo-render').innerHTML = db.photos.map(p => `
                <div class="polaroid" style="--r:${(Math.random()-0.5)*10}deg">
                    <img src="${p.url}">
                    <p>${p.note}</p>
                </div>
            `).join('');
        }

        function renderTimeline() {
            document.getElementById('timeline-render').innerHTML = db.moments.sort((a,b)=>new Date(b.date)-new Date(a.date)).map(m => `
                <div class="timeline-item">
                    <div class="timeline-content">
                        <span class="timeline-date">${m.date}</span>
                        <h4>${m.title}</h4>
                        <p style="font-size:14px; opacity:0.7; margin-top:10px;">${m.text}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderCapsules() {
            const now = new Date();
            document.getElementById('capsule-render').innerHTML = db.capsules.map((c, i) => {
                const isLocked = new Date(c.unlock) > now;
                return `
                    <div class="t-card" style="margin-bottom:20px; cursor:${isLocked?'not-allowed':'pointer'}" onclick="readCapsule(${i})">
                        <span style="font-size:24px;">${isLocked?'ğŸ”’':'âœ‰ï¸'}</span>
                        <h4 style="display:inline; margin-left:10px;">${c.title}</h4>
                        <p style="font-size:12px; opacity:0.4; margin-top:5px;">è§£å°æ—¥æœŸ: ${c.unlock}</p>
                    </div>
                `;
            }).join('');
        }

        function renderWishes() {
            document.getElementById('wish-render').innerHTML = db.wishes.map(w => `
                <div style="padding:15px; border-bottom:1px dashed #eee;">
                    <span style="color:var(--deep-rose);">â™¥</span> ${w}
                </div>
            `).join('');
        }

        // ==================== 4. è¯»ä¿¡ç‰¹æ•ˆé€»è¾‘ ====================
        function readCapsule(index) {
            const capsule = db.capsules[index];
            if (new Date(capsule.unlock) > new Date()) {
                alert("è¿˜æ²¡åˆ°å¼€å¯æ—¶é—´å“¦ï¼Œè¿™æ˜¯ä¸€ä»½æœªæ¥çš„æƒŠå–œ~");
                return;
            }
            
            const content = capsule.content.split('\n').map(line => `<p style="margin-bottom:30px;">${line}</p>`).join('');
            document.getElementById('credits-content').innerHTML = `
                <h1 style="font-size:3rem; color:var(--deep-rose); margin-bottom:100px;">${capsule.title}</h1>
                ${content}
                <div style="margin-top:200px; font-family:'Dancing Script'; font-size:2rem;">To Be Continued...</div>
            `;
            
            const reader = document.getElementById('movie-reader');
            reader.style.display = 'flex';
        }

        function closeReader() {
            document.getElementById('movie-reader').style.display = 'none';
        }

        // ==================== 5. ç®¡ç†åå°é€»è¾‘ ====================
        function showAdmin() {
            if(prompt("æš—å·") === CONFIG.pwd) document.getElementById('admin-modal').style.display = 'flex';
        }
        function hideAdmin() { document.getElementById('admin-modal').style.display = 'none'; }

        function saveData() {
            const type = document.getElementById('data-type').value;
            const title = document.getElementById('ipt-title').value;
            const content = document.getElementById('ipt-content').value;
            const date = document.getElementById('ipt-date').value;

            if (type === 'photo') db.photos.push({ url: content, note: title });
            if (type === 'moment') db.moments.push({ date, title, text: content });
            if (type === 'capsule') db.capsules.push({ unlock: date, title, content });

            localStorage.setItem('love_eternity', JSON.stringify(db));
            location.reload();
        }

    </script>
</body>
</html>